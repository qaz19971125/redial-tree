<template>
  <ul class="toolbar">
    <li :class="{ disabled: redoStack.length === 0 }" @click="redo">
      <svg
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
      >
        <path
          d="M256 682.666667c0-102.741333 66.730667-213.333333 213.333333-213.333334 107.008 0 190.762667 56.576 230.570667 125.354667L611.968 682.666667H853.333333v-241.365334l-91.562666 91.562667C704.768 448.469333 601.130667 384 469.333333 384c-196.096 0-298.666667 150.229333-298.666666 298.666667h85.333333z"
          fill=""
          p-id="2041"
        ></path>
      </svg>
    </li>
    <li :class="{ disabled: undoStack.length === 0 }" @click="undo">
      <svg
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
      >
        <path
          d="M170.666667 682.666667h241.365333l-87.936-87.978667C363.904 525.909333 447.658667 469.333333 554.666667 469.333333c146.602667 0 213.333333 110.592 213.333333 213.333334h85.333333c0-148.437333-102.570667-298.666667-298.666666-298.666667-131.797333 0-235.392 64.469333-292.48 148.821333L170.666667 441.301333V682.666667z"
          fill=""
          p-id="2764"
        ></path>
      </svg>
    </li>
    <li @click="$emit('center-chart')">
      <svg
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="24"
      >
        <path
          d="M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z"
        ></path>
      </svg>
    </li>
  </ul>
</template>

<script>
import Stack from './utils/Stack'

export default {
  name: 'ToolBar',
  components: {},
  mixins: [],
  data() {
    return {
      redoStack: new Stack(),
      undoStack: new Stack(),
    }
  },
  computed: {},
  watch: {},
  created() {
    this.$nextTick(() => {
      this.$on('pushStack', (data, stackType = 'undo') => {
        this.pushStack(data, stackType)
      })
    })
  },
  methods: {
    redo() {
      const currentData = this.redoStack.pop()
      if (currentData) {
        this.pushStack(currentData, 'undo')
        const { node, prunedNodes } = currentData
        this.toggleChildren(node)
        prunedNodes.forEach((d) => {
          this.toggleChildren(d)
        })
        this.$emit('update-chart', node)
      }
    },
    undo() {
      const currentData = this.undoStack.pop()
      if (currentData) {
        this.pushStack(currentData, 'redo')
        const { node, prunedNodes } = currentData
        this.toggleChildren(node)
        prunedNodes.forEach((d) => {
          this.toggleChildren(d)
        })
        this.$emit('update-chart', node)
      }
    },
    pushStack(data, stackType = 'undo') {
      if (stackType === 'undo') {
        this.undoStack.push(data)
      } else {
        this.redoStack.push(data)
      }
    },
    toggleChildren(d) {
      d.children = d.children ? null : d._children
    },
  },
}
</script>
<style lang="scss" scoped>
.toolbar {
  position: absolute;
  list-style-type: none;
  padding: 8px;
  left: 0px;
  top: 0px;
  background-color: rgba(255, 255, 255, 0.5);
  border: 1px solid #e2e2e2;
  border-radius: 4px;
  font-size: 12px;
  color: #545454;
  margin: 0;
  li {
    float: left;
    text-align: center;
    width: 35px;
    height: 24px;
    cursor: pointer;
    list-style-type: none;
    list-style: none;
    margin-left: 0px;
    &.disabled {
      .icon {
        opacity: 0.5 !important;
      }
      cursor: not-allowed;
    }
  }
}
</style>
